# cargo-deny configuration
# See: https://embarkstudios.github.io/cargo-deny/

[advisories]
ignore = [
    # paste crate unmaintained - transitive dependency from nalgebra -> simba
    # No action available since it's not a direct dependency
    "RUSTSEC-2024-0436",
]

[licenses]
# Confidence threshold for license detection
confidence-threshold = 0.8
# Don't fail on unused license allowances (different features may need different licenses)
unused-allowed-license = "allow"

# List of allowed licenses (non-copyleft)
# Any license not in this list will be denied, including GPL/LGPL/AGPL
allow = [
    "MIT",
    "Apache-2.0",
    "BSD-2-Clause",
    "BSD-3-Clause",
    "ISC",
    "Zlib",
    "CC0-1.0",
    "Unlicense",
    "MPL-2.0",      # Weak copyleft, file-level only
    "Unicode-3.0",  # Required by unicode-ident
    "BSL-1.0",      # Boost Software License (used by rerun dependencies)
    "CDLA-Permissive-2.0",  # Community Data License Agreement (used by rerun dependencies)
    "LicenseRef-Symbolica", # Proprietary, build-time only (see clarify below)
    # Font licenses used by egui's epaint_default_fonts
    "OFL-1.1",              # SIL Open Font License (OSI approved)
    "LicenseRef-UFL-1.0",   # Ubuntu Font License (permissive font license)
    # Used by image processing dependencies (via rav1e -> ravif -> image)
    "NCSA",                 # University of Illinois/NCSA Open Source License (OSI approved)
]

# Exceptions for build-time only dependencies (not linked into final binary)
# These dependencies are only used by clifford-codegen to generate source code.
# The generated code is not a derivative work of these libraries.
exceptions = [
    # symbolica's dependencies use LGPL, but only run at build time
    { crate = "gmp-mpfr-sys", allow = ["LGPL-3.0-or-later"] },
    { crate = "rug", allow = ["LGPL-3.0-or-later"] },
]

# symbolica has a proprietary license but is only used at build time for symbolic
# computation to generate source code - the output is independent of symbolica
[[licenses.clarify]]
crate = "symbolica"
expression = "LicenseRef-Symbolica"
license-files = []

[bans]
# Warn on multiple versions of same crate
multiple-versions = "warn"

[sources]
# Allow crates from crates.io
allow-registry = ["https://github.com/rust-lang/crates.io-index"]
